# 七日世界模组词条强化概率计算工具

这是一个用于计算七日世界游戏中模组词条强化成功概率的Python工具。

## 游戏规则

- 一个模组总共有4个词条
- 每个词条最低1级，最高5级
- 总共有5次强化机会
- 每次强化随机强化4个词条中的一个
- 如果有词条到达5级，下次强化时该词条不会在随机范围内

## 功能特性

- ✅ 计算达到目标等级的概率
- ✅ 支持两种判断模式：顺序无关模式和位置对应模式
- ✅ 支持显示所有可能的强化路径
- ✅ 输入验证和错误处理
- ✅ 交互式命令行界面
- ✅ 详细的结果分析

## 使用方法

### 方法1: 交互式运行

```bash
python3 mod_probability_calculator.py
```

按照提示输入：
1. 初始4个词条的等级（格式：1,2,3,1）
2. 目标4个词条的等级（格式：3,4,5,2）
3. 是否显示所有强化路径（y/n）
4. 选择判断模式：
   - 顺序无关模式（默认）：只要总体等级达到即可，不考虑位置
   - 位置对应模式：词条位置必须严格对应

### 方法2: 查看示例

```bash
python3 example_usage.py
```

这会运行多个示例，展示工具的不同使用场景。

### 方法3: 编程调用

```python
from mod_probability_calculator import ModProbabilityCalculator

calculator = ModProbabilityCalculator()

# 设置初始等级和目标等级
initial_levels = [1, 2, 3, 1]
target_levels = [3, 4, 5, 2]

# 计算概率
result = calculator.calculate_probability(
    initial_levels, 
    target_levels, 
    show_all_paths=True,
    order_independent=True  # True: 顺序无关, False: 位置对应
)

# 打印结果
calculator.print_result(result, initial_levels, target_levels)
```

## 输出说明

工具会输出以下信息：

1. **基本信息**：初始等级、目标等级、强化次数
2. **概率统计**：成功次数、总次数、成功概率（小数和百分比）
3. **路径详情**（可选）：
   - 成功路径：显示具体的强化顺序
   - 失败路径：显示未能达到目标的路径

## 示例输出

```
============================================================
七日世界模组词条强化概率计算结果
============================================================
初始等级: [1, 1, 1, 1]
目标等级: [2, 2, 2, 2]
强化次数: 5
------------------------------------------------------------
成功次数: 768
总次数: 1024
成功概率: 0.750000
成功概率: 75.0000%
```

## 文件说明

- `mod_probability_calculator.py`: 主要的计算工具
- `example_usage.py`: 使用示例和演示
- `README.md`: 使用说明文档

## 算法说明

工具使用递归算法计算所有可能的强化路径，基于以下数学原理：

### 数学模型

这是一个**多步随机过程**（马尔可夫链）问题：

#### 状态定义

设状态 $S = (l_1, l_2, l_3, l_4)$，其中 $l_i \in \{1,2,3,4,5\}$ 表示第i个词条的等级。

#### 转移概率

从状态 $S = (l_1, l_2, l_3, l_4)$ 到状态 $S' = (l_1', l_2', l_3', l_4')$ 的转移概率：

设 $K(S) = |\{i : l_i < 5\}|$ 为可强化词条数量

$$P(S \rightarrow S') = \begin{cases}
\frac{1}{K(S)} & \text{如果 } S' \text{ 是将 } S \text{ 中某个未满级词条等级+1的结果} \\
0 & \text{其他情况}
\end{cases}$$

#### 多步概率计算

经过5次强化后的概率分布：

$$P_5(S_0 \rightarrow S_f) = \sum_{\text{所有5步路径}} \prod_{i=0}^{4} P(S_i \rightarrow S_{i+1})$$

其中：
- $S_0$ = 初始状态
- $S_f$ = 最终状态  
- 路径：$S_0 \rightarrow S_1 \rightarrow S_2 \rightarrow S_3 \rightarrow S_4 \rightarrow S_5$

#### 成功概率公式

**位置对应模式：**
$$P_{\text{success}} = \sum_{S_f \in \Omega_{\text{success}}} P_5(S_0 \rightarrow S_f)$$

其中 $\Omega_{\text{success}} = \{(l_1, l_2, l_3, l_4) : l_i \geq t_i, \forall i\}$，$t_i$ 是目标等级。

**顺序无关模式：**
$$P_{\text{success}} = \sum_{S_f \in \Omega'_{\text{success}}} P_5(S_0 \rightarrow S_f)$$

其中 $\Omega'_{\text{success}} = \{(l_1, l_2, l_3, l_4) : \text{sort}(l_1, l_2, l_3, l_4) \geq \text{sort}(t_1, t_2, t_3, t_4)\}$

### 递归实现

实际计算中，这个概率可以递归展开为：

$$P_n(S_0 \rightarrow \text{目标}) = \sum_{i \in \text{可强化位置}} \frac{1}{|\text{可强化位置}|} \cdot P_{n-1}(\text{强化位置i后的状态} \rightarrow \text{目标})$$

边界条件：
$$P_0(S \rightarrow \text{目标}) = \begin{cases}
1 & \text{如果 } S \text{ 满足目标条件} \\
0 & \text{否则}
\end{cases}$$

### 算法步骤

1. 从初始状态开始，递归尝试每次强化的所有可能选择
2. 考虑满级词条不能继续强化的规则
3. 统计所有路径中达到目标的数量
4. 计算成功概率 = 成功路径数 / 总路径数

## 判断模式说明

### 顺序无关模式（推荐）
如果目标是 `[5,5,5,4]`，以下结果都算成功：
- `[5,5,5,4]` ✅ 
- `[5,4,5,5]` ✅
- `[4,5,5,5]` ✅
- `[5,5,4,5]` ✅

只要有3个5级和1个4级词条即可，不管它们的位置。

### 位置对应模式
如果目标是 `[5,5,5,4]`，只有完全对应的结果才算成功：
- `[5,5,5,4]` ✅
- `[5,4,5,5]` ❌（第2个位置4<5）
- `[4,5,5,5]` ❌（第1个位置4<5）
- `[5,5,4,5]` ❌（第3个位置4<5）

词条1必须≥目标词条1，词条2必须≥目标词条2，以此类推。

## 注意事项

- 计算复杂度随着强化次数和词条数量增长
- 当需要显示所有路径时，输出可能会很长
- 目标等级不能低于初始等级
- 所有等级必须在1-5范围内
- 顺序无关模式通常会有更高的成功概率

## 系统要求

- Python 3.6 或更高版本
- 无需额外依赖库 